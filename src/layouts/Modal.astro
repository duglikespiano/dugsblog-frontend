<dialog
  id="modal"
  class="pointer-events-none fixed top-0 left-0 z-[-10] flex h-svh w-full items-center justify-center bg-black/90 opacity-0 transition-all duration-300 [&.active]:pointer-events-auto [&.active]:z-10 [&.active]:opacity-100"
>
  <slot />
</dialog>

<script>
  import { isModalOpenStore } from "../common/stores";
  const modalBackground = document.querySelector("#modal") as HTMLElement;

  function closeModal() {
    isModalOpenStore.set(false);
  }

  function fixScrollWhenModalIsOpen(isOpen: boolean) {
    if (isOpen) {
      document.body.style.cssText = `
    position: fixed;
    top: -${window.scrollY}px;
    overflow-y: scroll;
    width: 100%;`;
    } else {
      const scrollY = document.body.style.top;
      document.body.style.cssText = "";
      window.scrollTo(0, parseInt(scrollY || "0", 10) * -1);
    }
  }

  modalBackground.addEventListener("click", closeModal);

  isModalOpenStore.subscribe((isOpen) => {
    if (isOpen) {
      modalBackground.classList.add("active");
      fixScrollWhenModalIsOpen(isOpen);
    } else {
      modalBackground.classList.remove("active");
      fixScrollWhenModalIsOpen(isOpen);
    }
  });
</script>
